<?phpsession_start();require_once('classes/requerimento.php');require_once('classes/util.php');$util = new Util();$util->Seguranca($_SESSION['idusuarios'], '../../index.php');function Processo($Processo) {    $util = new Util();    $requerimento = new Requerimento();    switch ($Processo) {        /* incluir */        case 'incluir':            global $linhaEdt;            global $rsEdt;            $requerimento->consultar("select * from inscricao where idusuarios=" . $_SESSION['idusuarios']);            $linhaEdt = $requerimento->Linha;            $rsEdt = $requerimento->Result;            $idinscricao = mysql_result($rsEdt, 0, 'idinscricao');            $nome = mysql_result($rsEdt, 0, 'nome');            $email = "pss@fundec.rj.gov.br";            if ($_POST['ok'] == 'true') {                try {                    $requerimento->consultar("BEGIN");                    $requerimento->incluir($idinscricao, strtoupper($_POST['descricao']));                    $requerimento->EnviarEmail($idinscricao, $_POST['descricao'], $email, $nome);                    $requerimento->consultar("COMMIT");                    $util->msgbox('REGISTRO SALVO COM SUCESSO!');                    $pg = "default.php?pg=" . base64_encode('view/publico/incluir.php') . "&form=" . base64_encode('Painel');                    $util->redirecionamentopage($pg);                } catch (Exception $ex) {                    $requerimento->consultar("ROLLBACK");                    $util->msgbox("Falha de operacao");                }            }            break;        case 'consulta':            global $linhaGestor;            global $rsGestor;            $requerimento = new Requerimento();            if ($_SESSION['idperfil'] == 2) {                $requerimento->consultar("select *, date_format(r.dtreg,'%d/%m/%Y %H:%i:%s') as dh from requerimento r inner join inscricao i on(i.idinscricao=r.idinscricao) where r.situacao='EM ANALISE' order by r.dtreg desc");                $linhaGestor = $requerimento->Linha;                $rsGestor = $requerimento->Result;            }            if ($_SESSION['idperfil'] == 1) {                $requerimento->consultar("select * from inscricao where idusuarios=" . $_SESSION['idusuarios']);                $linha = $requerimento->Linha;                $rs = $requerimento->Result;                $idinscricao = mysql_result($rs, 0, 'idinscricao');                $nome = mysql_result($rs, 0, 'nome');                $email = mysql_result($rs, 0, 'email');                $requerimento->consultar("select *, date_format(dtreg,'%d/%m/%Y %H:%i:%s') as dh from requerimento where idinscricao=" . $idinscricao);                $linha = $requerimento->Linha;                $rs = $requerimento->Result;            }            if ($_POST['ok'] == 'true') {                try {                    $requerimento->consultar("BEGIN");                    for ($i = 0; $i < $linhaGestor; $i++) {                        $idrequerimento = mysql_result($rsGestor, $i, 'idrequerimento');                        $idinscricao = mysql_result($rsGestor, $i, 'idinscricao');                        $nome = mysql_result($rsGestor, $i, 'nome');                        $email = mysql_result($rsGestor, $i, 'email');                        $situacao = 'RESPONDIDO';                        if ($_POST['ch' . $i] == "on") {                            if ($_POST['resposta' . $i] != '') {                                $requerimento->alterarGestao($idrequerimento, $idinscricao, $_POST['resposta' . $i], $situacao);                                $util->msgbox('REGISTRO SALVO COM SUCESSO!');                                $pg = "default.php?pg=" . base64_encode('view/publico/incluirGestao.php') . "&form=" . base64_encode('Painel');                                $util->redirecionamentopage($pg);                                $requerimento->consultar("COMMIT");                            } else {                                $util->msgbox('A RESPOSTA DO CANDIDATO ' . $nome . ' DEVE SER PREENCHIDA');                            }                        }                    }                } catch (Exception $ex) {                                    }            }            break;        /* Edição de dados */        case 'editar':            $requerimento->consultar("select * from inscricao where idusuarios=" . $_SESSION['idusuarios']);            $linha = $requerimento->Linha;            $rs = $requerimento->Result;            $idinscricao = mysql_result($rs, 0, 'idinscricao');            $nome = mysql_result($rs, 0, 'nome');            $email = mysql_result($rs, 0, 'email');            if ($_POST['ok'] == 'true') {                try {                    $requerimento->consultar("BEGIN");                    $requerimento->alterar($_GET['id'], strtoupper($_POST['descricao']), $util->formatoDataYMD($_POST['data_inicio']), $util->formatoDataYMD($_POST['data_fim']), $_POST['situacao']);                    $requerimento->alterar($idrequerimento, $idinscricao, $descricao, "EM ANALISE");                    $requerimento->consultar("COMMIT");                    $pg = "default.php?pg=" . base64_encode('view/publico/incluir.php') . "&form=" . base64_encode('Painel');                    $util->redirecionamentopage($pg);                } catch (Exception $ex) {                    $requerimento->consultar("ROLLBACK");                    $util->msgbox("Falha de operacao");                }            }            break;    }}?>