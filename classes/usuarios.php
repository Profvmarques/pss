<?phprequire_once('conexao.php');require_once('logs.php');class Usuarios {        private $idusuarios;    private $cpf;     private $senha;    private $idperfil;    private $dtreg;    public function incluirPublico($cpf,$senha,$idperfil) {         $insert = 'insert into usuarios(cpf,senha,idperfil, dtreg)values("'.$cpf.'","'.base64_encode($senha).'","'.$idperfil.'","'.date('Y-m-d H:i:s').'")';        $insert = str_replace("'", "\'", $insert);        $Acesso = new Acesso();        $Acesso->Conexao();        $Acesso->Query($insert);         $this->consultar("select max(idusuarios) as idU from usuarios");        $rs=$this->Result;        $idusuarios=mysql_result($rs,0,'idU');        return $idusuarios;    }    public function consultar($sql) {        $Acesso = new Acesso();        $Acesso->Conexao();        $Acesso->Query($sql);        $this->Linha = @mysql_num_rows($Acesso->result);        $this->Result = $Acesso->result;    }    public function Alterar($idusuarios,$nome,$login,$senha,$email,$idperfil,$idunidade_escolar,$situacao){        $update = ' update usuarios set login="'.$login.'",senha="'.base64_encode($senha).'",            email="'.$email.'",idperfil="'.$idperfil.'",idunidade_escolar="'.$idunidade_escolar.'",situacao="'.$situacao.'" where idusuarios="'.$idusuarios.'"';        $Acesso = new Acesso();        $Acesso->Conexao();        $Acesso->Query($update);        $Logs = new Logs();        $Logs->Incluir($_SESSION['idusuarios'], $update, 'usuarios', 'Alterar');    }       public function alteraSenha($idusuarios,$senha){        $update = 'update usuarios set senha="'.$senha.'" where idusuarios="'.$idusuarios.'"';        $Acesso = new Acesso();        $Acesso->Conexao();        $Acesso->Query($update);        $Logs = new Logs();        $Logs->Incluir($_SESSION['idusuarios'], $update, 'usuarios', 'alterar senha');    }         public function verificarCPF($cpf) {        $sql = " select * from usuarios where cpf='".$cpf."'";        $this->consultar($sql);        if ($this->Linha > 0) {            $util = new Util();            $util->Msgbox("CPF ja cadastrado na base de dados!");            $this->Achou = 'sim';        } else {            $this->Achou = 'nao';        }    }    	  public function EnviarEmail($cpf,$senha,$email,$perfil){                                      $link="http://www.fundec.rj.gov.br/pss/index.php";                     $to = $email;                    // subject                                         $subject = "Dados de acesso ao Sistema de Gestão de Matrícula - SGM";                    // message                    $message ='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Sistema de Gest&atilde;o de Matr&iacute;cula do Munic&iacute;pio de Duque de Caxias - SGM</title></head><body><div id="all" style="width:550px; background:#fff; margin-top:20px; text-align:center; margin:0 auto; font-family:Arial; font-size:12px">	<div id="logo"><img src="http://www.fundec.rj.gov.br/pss/img/logo.png" width="225" height="115" /></div>    <div id="content" style="width:460px; background:#fff; text-align:left; margin:-32px 14px 20px ; padding:30px ">    	<p>Olá <strong style="color:#000000"><?= $nome; ?></strong></p>        <p style=" background-color:#000; color:#fff; padding:5px;">Detalhes do seu acesso ao sistema como '.$perfil.'</p>        <p><strong>Login : </strong>'.$cpf.'</p>        <p><strong>Senha : </strong>'.  $senha.'</p>                    <p style="margin-top:40px">Por favor, n&atilde;o passe estas informa&ccedil;&otilde;es para terceiros.</p>        <p>Agora voc&ecirc; pode acessar no: <a href="'.$link.'" target="_blank" style="color:#f00; text-decoration:none;">http://www.fundec.rj.gov.br/pss/</a></p>                    </div></div></body></html>';                     // To send HTML mail, the Content-type header must be set                    $headers = 'MIME-Version: 1.0 ' . "\r\n";                    $headers.='X-Priority: 3' . "\r\n";                    $headers .= 'Content-type: text/html; charset=UTF-8' . "\r\n";                    $headers .= 'From: PSS-FUNDEC <pss@fundec.rj.gov.br>' . "\r\n";                    $headers.='Return-Path: ' . $email;                                        // Mail it                        try {                            mail($email, $subject,  $message, $headers);                                                    } catch (Exception $e) {                           echo $msg = "erro no servi&ccedil;o de envio de e-mail (SMTP) \n \r" . $e->getMessage();                        }                                   }}?>